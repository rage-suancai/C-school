宏定义

我们前面认识了#include指令 我们接着来看#define指令 它可以实现宏定义 我语文不好 宏是啥意思?

        https://smms.app/image/3CHdqbsAji78KwN

        把参数批量替换到文本中 这种实现通常称为宏(macro) 或定义宏(define macro)

我们可以通过#define来定义宏 规则如下:

                    #define     宏名(记号)     内容

比如现在我们想通过宏定义一个PI:

                    #define     PI 3.1415926

这样就可以了 那么怎么去使用它呢?

                    #include <stdio.h>

                    #define PI 3.1415926

                    int main() {
                        printf("π的值为: %f", PI);
                    }

在编译时 预处理程序会进行宏替换操作 也就是将程序中所有的PI全部替换为3.1415926 注意这个跟类型无关 是赤裸裸的纯文本替换 也就是相当于把我们的代码修改了
PI那里直接变成3.1415926 当然如果你定义为其他任意的内容 同样会替换到那个位置 但是至于替换之后程序还正不正常就不知道了

我们通过下面这个例子来加深对文本替换这句话的理解:

                    #include <stdio.h>

                    #define M a + b

                    int main() {
                        int a = 10, b = 20;
                        printf("%d", M * a);   // 各位觉得计算结果会是多少呢?
                    }

如果按照我们的正常思维 M是a+b 那么替换上去之后应该就是30了吧? 然后30x10最后应该得到的是300才对

        https://smms.app/image/ZOwauBAUCTscXYK

不过最后貌似并不是这样的 怎么会算出来的是210的呢?

实际上还是那句话 在编译时仅仅是做了文本替换 相当于最后我们的代码是:

                    printf("%d", a + b * a);

所以先计算的是 b * a 然后再加a 最后结果就是210了

当然任何地方都可以使用宏替换 包括类型 反正最后都会变成被替换的内容:

                    #define lbwnb long

                    int main() {
                        lbwnb a = 10L;
                    }

当然 出除了这种简单的替换之外我们还可以添加参数 就像函数那样:

                    #include <stdio.h>

                    #define MUL(x) x * x

                    int main() {
                        printf("%d", MUL(9));
                    }

虽然这里搞得像函数一样 但是最后还是会被替换为x * x 而这个x就是我们填写的参数 所以最后会变成 9 * 9 替换上去 程序运行出来的结果就是81了

直接调用函数肯定也是没问题的 反正就纯替换:

                    #include <stdio.h>

                    #define bb(i) printf("我是宏替换的: %d", i);

                    int main() {
                        bb(666);
                    }

那要是我想在字符串里面加一个宏定义中的参数呢?

                    #include <stdio.h>

                    #define bb(str) printf("我是宏替换的: "#str" <"); // 使用#直接在字符串中进行宏替换 否则默认情况下会被当做一个字符

                    int main() {
                        bb("你看这不就替换了吗");
                    }

当然还可以替换宏中的部分:

                    #define TEST(n) x ##n   // ##会使用参数进行拼接

                    int main() {
                        int TEST(1) = 10;   // 这里传入1，那么实际上就是被替换为x1
                        x1 = 20;   // 所以上面其实是int x1 = 10
                    }

宏既然可以定义出来 那么也可以取消定义 我们可以使用#undef来取消已有的宏定义:

        https://smms.app/image/ZA1j7dE2pKMXuVn

可以看到在使用#undef之后 直接不认识了

当然除了我们自己可以去定义之外 系统也为我们提供了一些预定义的宏:

                   宏名称                                     含义

                _ _ DATE _ _               当前的日期 格式为类似 Jun 27 2023 的字符串     

                _ _ TIME _ _                当前的时间 格式为类似 10:23:12 的字符串

                _ _ FILE _ _                 当前源代码文件的名称(含路径)的字符串

                _ _ LINE _ _                 当前所处的行号是多少就替换为多少 整数

这里只列出了一部分